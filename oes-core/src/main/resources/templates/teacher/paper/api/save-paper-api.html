<script src="/static/plugins/datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
<script src="/static/plugins/datetimepicker/js/locales/bootstrap-datetimepicker.zh-CN.js"></script>
<script src="/static/plugins/moment/moment.js"></script>
<script src="/webjars/adminlte/2.3.11/plugins/datepicker/bootstrap-datepicker.js"></script>
<script src="/webjars/adminlte/2.3.11/plugins/datepicker/locales/bootstrap-datepicker.zh-CN.js"></script>
<script src="/static/plugins/jquery-validation/jquery.validate.js"></script>
<script src="/static/plugins/jquery-form/jquery.form.min.js"></script>
<script src="/static/plugins/layer/layer.js"></script>
<script>

    // 获取课程集合
    $.get("/api/course/teacher/" + "${session.teacher.id}").done(function (data) {
        let options = "";
        //回填的二级类别值
        $('#courseId').empty();
        options += "<option value=''>请选择</option>";
        $.each(data, function (index, e) {
            options += "<option selected='true' value=" + e.id + ">" + e.courseName + "</option>";
        });
        $("#courseId").append(options).select2();
    });

    // 获取学院集合
    $.get("/api/academy").done(function (data) {
        let options = "";
        $('#academy').empty();
        options += "<option value=''>请选择</option>";
        $.each(data, function (index, e) {
            options += "<option value=" + e.id + ">" + e.name + "</option>";
        });
        $("#academy").append(options).val('').select2();
    });

    // 专选择框框回填
    function getAcademy(id) {
        // 获取学院集合
        $.get("/api/major/academy/" + id).done(function (data) {
            let options = "";
            //回填的二级类别值
            $('#majorId').empty();
            options += "<option value=''>请选择</option>";
            $.each(data, function (index, e) {
                options += "<option value=" + e.id + ">" + e.major + "</option>";
            });
            $("#majorId").append(options).val('').select2();
        });
    };

    // 试卷选择框
    $(function () {
        // select2
        $('#courseId').select2({width: "100%"});
        $('#paperType').select2({width: "100%"});

        const date = new Date();
        const picker = $("#datepicker").datetimepicker({
            format: "yyyy-mm-dd hh:ii",
            language: "zh-CN",
            autoclose: true,
            todayHighlight: true,
            startDate: date
        });
        picker.on("changeDate", function (e) {
            const time = $("#datepicker").val();
            const day = time.split(" ")[0];
            $('#datepicker2').datetimepicker('setStartDate', day);
        });
        let timepicker = $('#datepicker2').datetimepicker({
            format: "yyyy-mm-dd hh:ii",
            language: "zh-CN",
            autoclose: true,
            todayHighlight: true
        });

        // 提交组卷
        $('#saveBtn').click(function () {
            $.ajax({
                url:"/api/paper/save/random",
                type: "post",
                data: $('#addForm').serialize(),
                success: function (res) {
                    if (res.state === "success") {
                        layer.msg("添加成功");
                        window.location.href = "/teacher/paper/show/" + res.data;
                    } else {
                        layer.msg(res.message);
                    }
                }
            });
            return false;
        });
    });
</script>