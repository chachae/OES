<script>

    // 启动修改模态框
    $("#importBtn").click(function () {
        $("#importModal").modal({
            show: true,
            backdrop: 'static'
        });
    });


    // 启动查看模态框
    $(".goView").click(function () {
        $("#view-modal").modal({
            show: true,
            backdrop: 'static'
        });
    });

    // 启动修改模态框
    $(".goUpdate").click(function () {
        $("#update-modal").modal({
            show: true,
            backdrop: 'static'
        });
    });

    // 启动新增模态框
    $(".goSave").click(function () {
        $.get("/api/course/teacher/" + "${session.teacher.id}", function (data) {
            let options = "";
            //回填的二级类别值
            $('.courseSelect').empty();
            options += "<option value=''>请选择</option>";
            $.each(data, function (index, e) {
                options += "<option value=" + e.id + ">" + e.courseName + "</option>";
            });
            $(".courseSelect").append(options).select2({width: "100%"});
        });
        $(".difficulty").select2({width: "100%"});
        $("#save-modal").modal({
            show: true,
            backdrop: 'static'
        });
    });

    // 获取题目
    function getQuestion(id) {
        $.get("/api/question/" + id, function (data) {
            $(".questionName").val(data.questionName);
            $(".answer").val(data.answer);
            $(".course").val(data.course.courseName);
            $(".difficulty").val(data.difficulty).select2({width: "100%"});
            $(".teacherName").val(data.course.teacher.name);
            $(".typeId").val(data.type.id).select2({width: "100%"});
            $(".optionA").val(data.optionA);
            $(".optionB").val(data.optionB);
            $(".optionC").val(data.optionC);
            $(".optionD").val(data.optionD);
            $(".remark").val(data.remark);
            $(".id").val(data.id);
        })
    }

    // 更新题目
    function updateQuestion() {
        let data = $("#update-form").serialize();
        $.post("/api/question/update", data, function (data) {
            if (data.state === "success") {
                layer.msg("修改成功");
                window.location.reload();
            } else {
                layer.msg(data.message);
            }
        })
    }

    // 新增题目
    function saveQuestion() {
        let data = $("#save-form").serialize();
        $.post("/api/question/save", data, function (data) {
            if (data.state === "success") {
                layer.msg("增加成功");
                window.location.reload();
            } else {
                layer.msg(data.message);
            }
        })
    }


    // 删除题目
    function deleteQuestion(id) {
        layer.confirm("确定要删除么？", function () {
            $.post("/api/question/delete/" + id, function (data) {
                if (data.state === "success") {
                    layer.msg("删除成功");
                    window.location.reload();
                } else {
                    layer.msg(data.message);
                }
            })
        });
    }

    // 获取类型
    $.get("/api/type", function (data) {
        let options = "";
        //回填的二级类别值
        $('.typeSelect').empty();
        options += "<option value=''>请选择</option>";
        $.each(data, function (index, e) {
            options += "<option selected='true' value=" + e.id + ">" + e.typeName + "</option>";
        });
        $(".typeSelect").append(options).select2({width: "100%"});
    });

    // 自动上传
    $('body').on('change', '#upload', function () {
        var formData = new FormData();
        var files = $($(this))[0].files[0];
        formData.append("file", files);
        layer.msg('正在提交中....');
        $.ajax({
            url: '/api/question/import',
            type: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            success: function (res) {
                if (res.state === "success") {
                    layer.msg('题目解析成功，完成导入');
                    window.location.reload();
                } else {
                    layer.msg(res.message);
                    window.location.reload();
                }
            }
        });
    });

    // 进入试题详细信息
    $(function () {
        // 问题类型筛选
        $("#typeId").select2({width: "200px"}).change(function () {
            typeId = $(this).val();
            window.location.href = "/teacher/question?p=1&courseId=" + "${curCourseId}" + "&typeId=" + typeId;
        })

        // 课程筛选
        $("#courseId").select2({width: "200px"}).change(function () {
            courseId = $(this).val();
            console.log(courseId);
            window.location.href = "/teacher/question?p=1&courseId=" + courseId + "&typeId=" + "${curTypeId}";
        });

        //分页
        $('#pagination-demo').twbsPagination({
            totalPages: "${page.pages}",
            visiblePages: 5,
            first: '首页',
            last: '末页',
            prev: '上一页',
            next: '下一页',
            href: "?p={{number}}&courseId=" + "${curCourseId}" + "&typeId=" + "${curTypeId}",
        });
    });
</script>