<script>

    // 删除专业信息
    function deleteMajor(id) {
        layer.confirm("确定删除专业吗?", function () {
            $.post("/api/major/delete/" + id).done(function (data) {
                if (data.state === "success") {
                    layer.msg("删除成功!");
                    window.location.reload();
                } else {
                    layer.msg(data.message);
                }
            })
        });
    };

    // 获取专业信息
    function getMajor(id) {
        $.get("/api/major/" + id, function (data) {
            $('.id').val(data.id);
            $('.major').val(data.major);
            $('.academyId').val(data.academyId).select2({width: "100%"});
        })
    }

    // 启动修改模态框
    $(".goUpdate").click(function () {
        $("#update-modal").modal({
            show: true,
            backdrop: 'static'
        });

        // 更新专业信息
        $("#updateBtn").click(function () {
            layer.confirm("确定修改信息吗?", function () {
                let data = $('#update-form').serialize();
                $.post("/api/major/update/", data).done(function (data) {
                    if (data.state === "success") {
                        layer.msg("修改成功!");
                        window.location.reload();
                    }
                })
            })
        })
    });

    // 启动新增模态框
    $("#goSave").click(function () {
        $("#save-modal").modal({
            show: true,
            backdrop: 'static'
        });

        // 增加专业信息
        $("#saveBtn").click(function () {
            layer.confirm("确定增加专业吗?", function () {
                let data = $('#save-form').serialize();
                $.post("/api/major/save/", data).done(function (data) {
                    if (data.state === "success") {
                        layer.msg("增加成功!");
                        window.location.reload();
                    }
                })
            })
        })
    });

    // 分学院搜索
    $("#findAcademy").select2({
        width: "200px"
    }).change(function () {
        // 调用接口
        let id = $('#findAcademy').val();
        window.location.href = "/teacher/major?p=1&academyId=" + id
    });

    // 填充学院信息
    $.get("/api/academy").done(function (data) {
        let options = "";
        $('.academySelect').empty();
        options += "<option value=''>全部</option>";
        $.each(data, function (index, e) {
            options += "<option value=" + e.id + ">" + e.name + "</option>";
        });
        $(".academySelect").append(options).val('${curAcademyId}').select2();
    });


    //分页
    $('#pagination-demo').twbsPagination({
        totalPages: "${page.pages}",
        visiblePages: 5,
        first: '首页',
        last: '末页',
        prev: '上一页',
        next: '下一页',
        href: '/teacher/major?p={{number}}&academyId=' + '${curAcademyId}',
    });
</script>